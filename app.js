var canvas=document.getElementById("renderCanvas"),engine=new BABYLON.Engine(canvas,!0,{preserveDrawingBuffer:!0,stencil:!0}),isMobile=function(){var e=navigator.userAgent,t=/iPhone/i;return!!(t.test(e)||t.test(e)||/iPod/i.test(e)||/iPad/i.test(e)||/(?=.*\bAndroid\b)(?=.*\bMobile\b)/i.test(e)||/Android/i.test(e)||/IEMobile/i.test(e)||/(?=.*\bWindows\b)(?=.*\bARM\b)/i.test(e)||/BlackBerry/i.test(e)||/Opera Mini/i.test(e)||/(?=.*\bFirefox\b)(?=.*\bMobile\b)/i.test(e))}(),seek=function(e,t,n){var o=-.5;n.registerBeforeRender(function(){var n=BABYLON.Vector3.Distance(e.position,t.position);if(e.rotation.x=0,t){faceTarget(e,t);o=n<10?0:-.5,e.locallyTranslate(new BABYLON.Vector3(o,0,0))}})};function facePoint(e,t){var n=t.subtract(e.position);if(n.length()>.5){var o=calculateRotationDeltaForAxis(e,"y",new BABYLON.Vector3(0,0,1),n,"x"),i=calculateRotationDeltaForAxis(e,"z",new BABYLON.Vector3(0,1,0),n,"z"),r=applyRotationForAxis(e,"y",o),a=applyRotationForAxis(e,"z",i);return!(!r||!a)}}function faceTarget(e,t){return facePoint(e,t.position)}function calculateRotationDeltaForAxis(e,t,n,o,i){var r=n.normalize(),a=o.normalize(),l=Math.acos(BABYLON.Vector3.Dot(r,a));return"x"==i?(o[i]<0&&(l*=-1),l+=Math.PI/2):l-=Math.PI/2,e.rotation[t]-l}function applyRotationForAxis(e,t,n){var o=Math.PI;n>o?n-=2*o:n<-o&&(n+=2*o);var i=Math.abs(n);if(i>o/360){var r=Math.max(.2,Math.min(i*i,1));return n>0&&(e.rotation[t]-=.1*r,e.rotation[t]<-o&&(e.rotation[t]=o)),n<0&&(e.rotation[t]+=.1*r,e.rotation[t]>o&&(e.rotation[t]=-o)),!1}return!0}var createBubbles=function(e,t){var n=new BABYLON.StandardMaterial("mat1",t);n.alpha=.1;var o=BABYLON.MeshBuilder.CreateSphere("s",{diameter:3,segments:12},t),i=new BABYLON.SolidParticleSystem("SPS",t);i.addShape(o,30);var r=i.buildMesh();r.material=n,r.position.x=-10,r.parent=e,o.dispose();i.initParticles=function(){for(var e=0;e<this.nbParticles;e++)this.recycleParticle(this.particles[e])};var a=0;i.recycleParticle=function(e){e.position.x=0,e.position.y=0,e.position.z=0,e.velocity.x=.6*(Math.random()-.5)/3,e.velocity.y=.6*(Math.random()-.5)/3,e.velocity.z=.6*(Math.random()-.5)/3,a=2*Math.random()+.5,e.scale.x=a,e.scale.y=a,e.scale.z=a,e.age=Math.random()},i.updateParticle=function(e){(e.position.y<0||e.age<0)&&this.recycleParticle(e),e.velocity.y+=-.002,e.position.addInPlace(e.velocity),e.position.y+=.6*Math.random()/2,e.position.x-=.6*Math.random()/2,e.age-=.001},i.initParticles(),i.setParticles(),i.computeParticleColor=!1,i.computeParticleTexture=!1,i.computeParticleRotation=!1,this.SPS=i};createBubbles.prototype.update=function(){this.SPS.setParticles()};var addFish=function(e){BABYLON.Effect.ShadersStore.fishMainVertexShader="precision highp float;\n// Attributes\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\n// Uniforms\nuniform mat4 worldViewProjection;\nuniform float time;\nuniform float speed;\nuniform float fishHead;\nvarying vec3 vPosition;\nvarying vec2 vUV;\n\n\nmat4 rotationY(float angle)\n{\n\tfloat c = cos(angle);\n\tfloat s = sin(angle);\n\t\n\tmat4 r = mat4\n\t(\n\t\tc,   0.0, s,   0.0,\n\t\t0.0, 1.0, 0.0, 0.0,\n\t\t-s,  0.0, c,   0.0,\n\t\t0.0, 0.0, 0.0, 1.0\n\t);\n\t\n\treturn r;\n}\n\nmat3 normalRotationY(float angle)\n{\n\tfloat c = cos(angle);\n\tfloat s = sin(angle);\n\t\n\tmat3 r = mat3\n\t(\n\t\tc,   0.0, -s,\n\t\t0.0, 1.0, 0.0,\n\t\ts,   0.0, c\n\t);\n\t\n\treturn r;\n}\n\nvoid main() {\n    vec4 p = vec4( position, 2. );\n\tfloat _t = sin(time*speed);\n\tfloat lateralDist = 12.4;\nfloat distortionAmt = 10000.0;\nfloat angle = speed * sin(time) * pow((p.x*4.) + lateralDist, 2.) / distortionAmt;\n\n// Setup rotation matrices\n\tmat4 matrix = mat4(1.0);\n\tmat3 normalMatrix = mat3(1.0);\n\tmatrix = rotationY(angle) * matrix;\n\tnormalMatrix = normalRotationY(angle) * normalMatrix;\n\np.z += angle;\n//p.x *= angle*50.;\n\tvPosition = p.xyz;\n\tvUV = uv;\n\n\tgl_Position = worldViewProjection * (p);\t\n}",BABYLON.Effect.ShadersStore.fishMainFragmentShader="precision highp float;\n\nuniform float time;\nuniform sampler2D fishTexture;\n\nvarying vec3 vPosition;\nvarying vec2 vUV;\n\n\nvoid main(){\n\tvec3 color = vec3(0);\n\tfloat alpha = 1.;\n\tvec4 cSample = texture2D(fishTexture, vUV);\t\n\tcolor = cSample.rgb;\n   if ( cSample.a < .5 ) discard;\n\tgl_FragColor =  vec4(color, alpha);\n    \n}";var t=new BABYLON.ShaderMaterial("fishShader",e,{vertex:"fishMain",fragment:"fishMain"},{attributes:["position","normal","uv"],samplers:["fishTexture"],uniforms:["world","worldView","worldViewProjection","view","time","speed","fishHead"]}),n=new BABYLON.Texture("https://cdn.glitch.com/9fc921e3-db5b-4af6-9426-ecd872050c1f%2Fherring-clipart-blueback-herring.png?v=1563401506876",e);t.setTexture("fishTexture",n),t.setFloat("time",1),t.setFloat("speed",24),t.setFloat("fishHead",13.5),t.backFaceCulling=!1;var o=BABYLON.MeshBuilder.CreateGround("whale",{height:5,width:5},e);o.forceSharedVertices(),o.increaseVertices(2),o.rotation.x=2*Math.PI,o.rotation.y=2*Math.PI,o.scaling.set(-20,2,12),o.material=t,o.position.y=1,o.position.z=200;var i=0;e.registerBeforeRender(()=>{t.setFloat("time",i),i+=.3});var r=new THREE.Scene,a=new THREE.SphereGeometry(100,32,16),l=new THREE.MeshLambertMaterial({color:16711680}),s=new THREE.Mesh(a,l);s.position.y=100,r.add(s);var c=new SteeringEntity(s);r.add(c),c.position.z=9e4,c.position.y=100;for(var d=[],u=[],h=0;h<10;h++){var B=400-800*Math.random(),p=400-800*Math.random(),m=s.clone();m.position.y=100;var g=o.clone();g.name="whale",g.position.set(0,1,h/2*200),(c=new SteeringEntity(m)).position.z=100*p,c.position.x=100*B,c.position.y=100,d.push(c),r.add(c),u.push(g)}var f=new BABYLON.Mesh("m",e);f.position.set(-411.8787152107947,-2.842170943040401e-14,225.94796690747145);var v=[],A=(e.getMeshByName("impostor"),0);e.registerBeforeRender(()=>{(A+=1)%1e3==0&&f.position.set(-411.8787152107947,-2.842170943040401e-14,225.94796690747145),A%750==0&&f.position.set(279.120338939376,1.0000000000000284,160.24275715541953),c.update(),o.rotation.copyFrom(c.rotation),o.position.copyFrom(new BABYLON.Vector3(c.position.x/100,c.position.y/100,c.position.z/100)),v.push(c.position.clone()),v.length>=2&&(v[v.length-1].x>v[v.length-2].x?o.scaling.x=-10:o.scaling.x=10),3==v.length&&(v.length=0),c.seek(new THREE.Vector3(100*f.position.x,100*f.position.y,100*f.position.z));for(var t=0;t<d.length;t++)e.meshes.forEach(function(e){var n,i;"waste"===e.name&&o.intersectsMesh(e)&&(n=e.position,.01*(i=d[t]).position.distanceTo(new THREE.Vector3(100*n.x,100*n.y,100*n.z))<30?i.flee(new THREE.Vector3(100*n.x,100*n.y,100*n.z)):d[t].followLeader(c,d,400,3e3,500,1e3,200))}),d[t].maxSpeed=100,c.seek(new THREE.Vector3(100*f.position.x,100*f.position.y,100*f.position.z)),c.maxSpeed=60,u[t].scaling.x=o.scaling.x,u[t].position.copyFrom(new BABYLON.Vector3(d[t].position.x/100,d[t].position.y/100,d[t].position.z/100)),d[t].update()})},huluScene=(isMobile=function(){var e=navigator.userAgent,t=/iPhone/i;return!!(t.test(e)||t.test(e)||/iPod/i.test(e)||/iPad/i.test(e)||/(?=.*\bAndroid\b)(?=.*\bMobile\b)/i.test(e)||/Android/i.test(e)||/IEMobile/i.test(e)||/(?=.*\bWindows\b)(?=.*\bARM\b)/i.test(e)||/BlackBerry/i.test(e)||/Opera Mini/i.test(e)||/(?=.*\bFirefox\b)(?=.*\bMobile\b)/i.test(e))}(),function(){var e=new BABYLON.Scene(engine);e.collisionsEnabled=!0,e.clearColor=BABYLON.Color3.Black();var t=new BABYLON.ArcRotateCamera("Camera",0,.8,300,BABYLON.Vector3.Zero(),e);e.activeCameras.push(t),e.level=levels.hulu,e.hookSelected=!1,e.engineRepair=!1,e.engineRepair_food=!1,e.backgroundTexture=new BABYLON.VideoTexture("video",["https://cdn.glitch.com/9fc921e3-db5b-4af6-9426-ecd872050c1f%2Ffinal_5d27c29c9ea5f00014146d79_855701.mp4?v=1562886852603"],e,!0),e.backgroundTexture.video.muted=!0,t.setPosition(new BABYLON.Vector3(.4088619795739057,10.783595436895611,0)),t.setTarget(new BABYLON.Vector3(0,0,200)),new BABYLON.HemisphericLight("light",new BABYLON.Vector3(0,1,0),e).intensity=.7,t.beta=.037897028819031287,t.alpha=23.55063297579997;var n=new BABYLON.ArcRotateCamera("Camera",0,.8,300,BABYLON.Vector3.Zero(),e);n.setTarget(BABYLON.Vector3.Zero()),e.activeCameras=[],e.activeCameras.push(t),t.layerMask=1,n.layerMask=2,n.setPosition(new BABYLON.Vector3(.4088619795739057,10.783595436895611,1e3)),n.setTarget(new BABYLON.Vector3(0,0,200)),n.beta=.037897028819031287,n.alpha=23.55063297579997;var o=BABYLON.GUI.AdvancedDynamicTexture.CreateFullscreenUI("UI");createSubmarinerWorld(e),initPostprocess(e,t),createWasteDebris(e),subplayer(t,n,o,97.39582987611732,1,275.8905629686685,e);new BABYLON.BlackAndWhitePostProcess("bandw",1,t);addFish(e),this.playerInfo;var i="",r=function(){var e=new BABYLON.GUI.Rectangle;e.width="440px",e.height="440px",e.cornerRadius=0,e.color="gray",e.thickness=4,e.background="silver";var t=new BABYLON.GUI.TextBlock;return t.text="THIS GAME IS MADE WITH \r\nTHE AWESOME 3D ENGINE\r\n-BABYLONJS\r\n\r\nThanks to the team who collaborated\r\nto create this beautiful engine",t.color="white",t.top="-100px",e.addControl(t),o.addControl(e),e};!function(){var t=new BABYLON.GUI.TextBlock;t.text="",t.fontFamily="Chalkduster",t.color="white",t.fontSize=24,t.top="200px",isMobile&&(t.top=100),t.zIndex=-150,o.addControl(t);var n=new BABYLON.GUI.TextBlock;n.text="",n.fontFamily="Chalkduster",n.color="white",n.fontSize=14,n.top="150px",isMobile&&(n.top=50),n.zIndex=-150,o.addControl(n);var r=0,a={};r=1;var l=BABYLON.GUI.Button.CreateSimpleButton("but","SKIP");l.width="80px",l.height="50px",l.textBlock.fontFamily="Chalkduster",l.textBlock.fontSize=24,l.outlineColor="green",l.thickness=0,l.color="none",l.top="120px",l.isVisible=!1,l.left="300px",l.zIndex=-150,isMobile&&(l.top=7),o.addControl(l);var s=function(e,t){var n=new BABYLON.GUI.Rectangle;n.width="240px",n.height="240px",n.cornerRadius=0,n.color="gray",n.thickness=4,n.background="silver",n.left=e+"px",n.isVisible=!0,n.buttons=[],o.addControl(n),this.background=n,this.buttons=n.buttons};s.prototype.getBackgroundData=function(){return this.background},s.prototype.link=function(e){this.buttons.forEach(function(t){t.onPointerUpObservable.add(function(){e.getBackgroundData().buttons.forEach(function(e){t.name===e.name&&(e.textBlock.text=t.textBlock.text,t.textBlock.text="")})})});var t=this.buttons;e.getBackgroundData().buttons.forEach(function(e){e.onPointerUpObservable.add(function(){t.forEach(function(t){e.name===t.name&&(t.textBlock.text=e.textBlock.text,e.textBlock.text="")})})})},s.prototype.retrieve=function(e){for(var t=0;t<3;t++)for(var n=0;n<3;n++){var o=BABYLON.GUI.Button.CreateSimpleButton("but"+t+n);o.width="64px",o.height="64px",o.top=t/4*240-60+"px",o.left=n/4*240-60+"px",this.background.addControl(o),this.background.buttons.push(o),null!=e.perInventoryData[t]&&(console.log(e.perInventoryIndex[t]),o.name===e.perInventoryIndex[t].name&&(console.log(o),o.textBlock.text="kk"))}};var c=new BABYLON.GUI.StackPanel;c.width="220px",c.horizontalAlignment=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_RIGHT,c.verticalAlignment=BABYLON.GUI.Control.VERTICAL_ALIGNMENT_CENTER,o.addControl(c);var d=new BABYLON.GUI.TextBlock;d.text="Engine cond.",d.height="30px",d.color="white",c.addControl(d);var u=new BABYLON.GUI.ImageBasedSlider;u.minimum=0,u.maximum=2*Math.PI,u.isThumbClamped=!1,u.isVertical=!0,u.displayThumb=!1,u.backgroundImage=new BABYLON.GUI.Image("back","https://www.babylonjs-playground.com/textures/gui/backgroundImage-vertical.png"),u.valueBarImage=new BABYLON.GUI.Image("value","https://cdn.glitch.com/09092405-1738-440c-b976-c47b88794255%2FVertical_gradient.jpg?v=1564259497746"),u.isVertical?(u.width="20px",u.height="200px"):(u.height="20px",u.width="200px"),u.color="red",c.addControl(u);var h=0,B=BABYLON.GUI.Button.CreateSimpleButton("but","");B.textBlock.text="Highest point earned: "+localStorage.getItem("highscore")+"\nPoints Earned: "+h,B.initialScore=localStorage.getItem("highscore"),B.textBlock.fontFamily="Chalkduster",B.color="white",B.width="464px",B.height="64px",B.thickness=0,B.textBlock.fontSize=24,B.verticalAlignment=BABYLON.GUI.Control.VERTICAL_ALIGNMENT_TOP,B.horizontalAlignment=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_CENTER,B.zIndex=-150,o.addControl(B);var p=new BABYLON.GUI.Rectangle;p.width="300px",p.height="300px",p.horizontalAlignment=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_CENTER,p.verticalAlignment=BABYLON.GUI.Control.VERTICAL_ALIGNMENT_CENTER,p.background="gray",p.zIndex=-150,p.isVisible=!1;var m=new BABYLON.GUI.TextBlock;m.text="Game Over! \nEngine damaged",m.fontFamily="Chalkduster",m.color="white",m.fontSize=14,m.top="-60px",p.addControl(m);var g=BABYLON.GUI.Button.CreateSimpleButton("but","retry");g.width="100px",g.height="60px",g.textBlock.fontFamily="Chalkduster",g.textBlock.fontSize=24,p.addControl(g),g.clicked=!1,o.addControl(p),g.onPointerUpObservable.add(function(){window.location.reload()}),null==localStorage.getItem("highscore")&&localStorage.setItem("highscore",0);var f=0,v=0,A=0,b=0,x=!1,N=e.getMeshByName("impostor");e.registerAfterRender(function(){if(e.hookSelected&&(r=2),e.meshes.forEach(function(t){"waste"===t.name&&N.intersectsMesh(t)&&e.hookSelected&&(t.dispose(),h+=10,localStorage.setItem("score",h),h>parseInt(B.initialScore)&&localStorage.setItem("highscore",h),B.textBlock.text="Highest point earned: "+localStorage.getItem("highscore")+"\nPoints Earned: "+h),"whale"===t.name&&N.intersectsMesh(t)&&(u.value-=9e-4)}),0==u.value&&(r=3,e.hookSelected=!1),u.value<4&&(r=4,e.hookSelected=!1),e.engineRepair&&(u.value=6),e.engineRepair_food&&(u.value+=1),++b%8==0)switch(r){case 1:n.text="Mission Brief: Implement 🗑️ from inventory, then move closer to debris to clear them",l.clicked||(l.isVisible=!0),l.onPointerDownObservable.add(function(){l.clicked=!0,t.text="Open inventory and select 🗑️",i="Open inventory and select 🗑️",l.isVisible=!1,t.skipped=!0,x=!0}),t.skipped||(a.intro="Are you ready, submariner?\nThen off you go\nGo earn yourself some tunas\nStart by clearing the debris first of\nOpen inventory and select 🗑️",f<a.intro.length&&(t.text+=a.intro.charAt(f),t.text.includes("\n")&&(t.text=" "),t.text.includes("Open inventory and select 🗑️")&&(i="Open inventory and select 🗑️",x=!0),f++));break;case 2:a.intro="\nMove closer to debris waste to automatically clear them",v<a.intro.length&&(t.text+=a.intro.charAt(v),i="Move closer to debris waste to automatically clear them",t.text.includes("\n")&&(t.text=" "),v++);break;case 3:a.intro="\nGame Over!\nYour engine was destroyed\nAvoid collision and Be careful next time",g.clicked||(p.isVisible=!0),A<a.intro.length&&(t.text+=a.intro.charAt(A),t.text.includes("\n")&&(t.text=" "),A++);break;case 4:t.text="\nEngine about to break down due to collisions\nOpen inventory and select 🛠️ to repair",e.engineRepair&&!x&&(r=1)}})}(),function(){var t=new BABYLON.GUI.Rectangle;t.width="440px",t.height="440px",t.cornerRadius=0,t.color="gray",t.thickness=4,t.background="silver",t.isVisible=!1;for(var n=["Audio","Credits","Exit Game","Missions"],a=0;a<n.length;a++){var l=BABYLON.GUI.Button.CreateSimpleButton("but",n[a]);switch(l.width="234px",l.height="34px",l.top=a/4*240-100+"px",t.addControl(l),a){case 0:l.onPointerUpObservable.add(function(){e.backgroundTexture.video.muted=!0});break;case 1:l.onPointerUpObservable.add(function(){t.isVisible=!1;var e=new r;setTimeout(function(){e.dispose(),e.zIndex=-1},4e3)});break;case 2:l.onPointerUpObservable.add(function(){t.isVisible=!1});break;case 3:l.onPointerUpObservable.add(function(){var e=(new r).children[0];e.text=i+"\nMission progress: 0/10",setTimeout(function(){e.parent.dispose(),e.zIndex=-1},4e3)})}}o.addControl(t);var s=BABYLON.GUI.Button.CreateSimpleButton("menu","Options");s.width="134px",s.height="44px",s.horizontalAlignment=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT,s.verticalAlignment=BABYLON.GUI.Control.VERTICAL_ALIGNMENT_TOP,s.cornerRadius=10,s.color="gray",s.thickness=4,s.background="silver",o.addControl(s),s.onPointerUpObservable.add(function(){1==t.isVisible?t.isVisible=!1:t.isVisible=!0})}();var a=function(e,t){var n=BABYLON.Mesh.CreatePlane("plane",5);n.position.addInPlace(t.position),n.rotation.addInPlace(t.rotation),n.scaling.addInPlace(t.scaling);var o=BABYLON.GUI.AdvancedDynamicTexture.CreateForMesh(n),i=new BABYLON.GUI.TextBlock;return i.text=e,i.color="black",i.fontSize=500,i.name=t.name+"Gui",o.addControl(i),n.layerMask=2,i};e.meshes.forEach(function(e){"portal"===e.name&&new a("W",e),"pod"===e.name&&new a("H",e)});!function(){var o=new BABYLON.RenderTargetTexture("depth",1024,e,!0,!0);e.customRenderTargets.push(o),o.activeCamera=n,n.alpha=26.700632975800016,setTimeout(function(){e.meshes.forEach(function(e){"portal"!==e.name&&"viewport"!==e.name&&"PlayerPod"!==e.name&&o.renderList.push(e)})},3e3);var i=e.getMeshByName("sea").clone();i.name="viewport",i.position=new BABYLON.Vector3(canvas.width/130,canvas.height/150+4,20);var r=new BABYLON.StandardMaterial("texturePlane",e);r.diffuseColor=new BABYLON.Color3(1,1,1),r.diffuseTexture=o,r.specularColor=BABYLON.Color3.Black(),r.diffuseTexture.uScale=1,r.diffuseTexture.vScale=1,r.diffuseTexture.level=1.2,i.enableEdgesRendering(.9999999),i.edgesWidth=5,i.edgesColor=new BABYLON.Color4(0,0,0,0),r.emissiveColor=new BABYLON.Color3(1,1,1),i.material=r,i.parent=t,i.scaling.set(-.02,.02,.02),i.rotation.x=Math.PI/2,i.layerMask=1,i.renderingGroupId=2,i.position.y=2,i.rotate(new BABYLON.Vector3(0,1,0),Math.PI),e.registerBeforeRender(()=>{})}(),this.scene=e,this.advancedTexture=o,e.backgroundTexture.video.muted=!0});huluScene.prototype.copyPlayer=function(e){var t=e,n=this.scene;this.advancedTexture.addControl(t.getBackgroundData()),console.log("inventory",t);var o=BABYLON.GUI.Button.CreateSimpleButton("menu","Inventory >");o.width="184px",o.height="44px",o.horizontalAlignment=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_CENTER,o.verticalAlignment=BABYLON.GUI.Control.VERTICAL_ALIGNMENT_BOTTOM,o.cornerRadius=10,o.color="gray",o.thickness=4,o.background="silver",this.advancedTexture.addControl(o),o.onPointerUpObservable.add(function(){1==t.getBackgroundData().isVisible?(t.getBackgroundData().isVisible=!1,o.children[0].text="Inventory >"):(t.getBackgroundData().isVisible=!0,o.children[0].text="Inventory <")});var i=[];t.getBackgroundData().buttons.forEach(function(e){i.push([e.name,e.textBlock.text])}),t.getBackgroundData().buttons.forEach(function(e){e.onPointerUpObservable.add(function(){for(var t=0;t<i.length;t++)i[t][0]===e.name&&(console.log(i[t][1]),"🗑️"===i[t][1]&&(n.hookSelected=!0),"🛠️"===i[t][1]&&(n.engineRepair=!0,setTimeout(function(){n.engineRepair=!1},500)),"🐟"===i[t][1]&&(n.engineRepair_food=!0,setTimeout(function(){n.engineRepair_food=!1},500)))})})},huluScene.prototype.getScene=function(){return this.scene};var mobileControls=function(e,t,n,o){var i,r,a=(i=navigator.userAgent,!!((r=/iPhone/i).test(i)||r.test(i)||/iPod/i.test(i)||/iPad/i.test(i)||/(?=.*\bAndroid\b)(?=.*\bMobile\b)/i.test(i)||/Android/i.test(i)||/IEMobile/i.test(i)||/(?=.*\bWindows\b)(?=.*\bARM\b)/i.test(i)||/BlackBerry/i.test(i)||/Opera Mini/i.test(i)||/(?=.*\bFirefox\b)(?=.*\bMobile\b)/i.test(i)));let l=BABYLON.GUI.AdvancedDynamicTexture.CreateFullscreenUI("UI"),s=0,c=0,d=0,u=0,h=v("leftThumb",2,"blue",null);h.height="160px",h.width="160px",h.isPointerBlocker=!0,h.horizontalAlignment=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT,h.verticalAlignment=BABYLON.GUI.Control.VERTICAL_ALIGNMENT_BOTTOM,h.alpha=.4;let B=v("leftInnterThumb",4,"blue",null);B.height="80px",B.width="80px",B.isPointerBlocker=!0,B.horizontalAlignment=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_CENTER,B.verticalAlignment=BABYLON.GUI.Control.VERTICAL_ALIGNMENT_CENTER;let p=v("leftPuck",0,"blue","blue");p.height="60px",p.width="60px",p.isPointerBlocker=!0,p.horizontalAlignment=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_CENTER,p.verticalAlignment=BABYLON.GUI.Control.VERTICAL_ALIGNMENT_CENTER,h.onPointerDownObservable.add(function(e){p.isVisible=!0,p.floatLeft=e.x-.5*h._currentMeasure.width,p.left=p.floatLeft,p.floatTop=l._canvas.height-e.y-.5*h._currentMeasure.height,p.top=-1*p.floatTop,p.isDown=!0,h.alpha=.9}),h.onPointerUpObservable.add(function(e){s=0,c=0,p.isDown=!1,p.isVisible=!1,h.alpha=.4}),h.onPointerMoveObservable.add(function(e){p.isDown&&(s=e.x-.5*h._currentMeasure.width,c=l._canvas.height-e.y-.5*h._currentMeasure.height,p.floatLeft=s,p.floatTop=-1*c,p.left=p.floatLeft,p.top=p.floatTop)}),l.addControl(h),h.addControl(B),h.addControl(p),p.isVisible=!1;let m=v("rightThumb",2,"red",null);m.height="160px",m.width="160px",m.isPointerBlocker=!0,m.horizontalAlignment=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_RIGHT,m.verticalAlignment=BABYLON.GUI.Control.VERTICAL_ALIGNMENT_BOTTOM,m.alpha=.4;let g=v("rightInnterThumb",4,"red",null);g.height="80px",g.width="80px",g.isPointerBlocker=!0,g.horizontalAlignment=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_CENTER,g.verticalAlignment=BABYLON.GUI.Control.VERTICAL_ALIGNMENT_CENTER;let f=v("rightPuck",0,"red","red");function v(e,t,n,o,i){let r=new BABYLON.GUI.Ellipse;return r.name=e,r.thickness=t,r.color=n,r.background=o,r.paddingLeft="0px",r.paddingRight="0px",r.paddingTop="0px",r.paddingBottom="0px",r}f.height="60px",f.width="60px",f.isPointerBlocker=!0,f.horizontalAlignment=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_CENTER,f.verticalAlignment=BABYLON.GUI.Control.VERTICAL_ALIGNMENT_CENTER,m.onPointerDownObservable.add(function(e){f.isVisible=!0,f.floatLeft=l._canvas.width-e.x-.5*m._currentMeasure.width,f.left=-1*f.floatLeft,f.floatTop=l._canvas.height-e.y-.5*m._currentMeasure.height,f.top=-1*f.floatTop,f.isDown=!0,m.alpha=.9}),m.onPointerUpObservable.add(function(e){d=0,u=0,f.isDown=!1,f.isVisible=!1,m.alpha=.4}),m.onPointerMoveObservable.add(function(e){f.isDown&&(d=l._canvas.width-e.x-.5*m._currentMeasure.width,u=l._canvas.height-e.y-.5*m._currentMeasure.height,f.floatLeft=-1*d,f.floatTop=-1*u,f.left=f.floatLeft,f.top=f.floatTop)}),l.addControl(m),m.addControl(g),m.addControl(f),f.isVisible=!1,o.registerBeforeRender(function(){e.moveWithCollisions(new BABYLON.Vector3(.02*s,0,.02*c)),t.alpha+=d/15e3*-1,t.alpha+=u/15e3*-1,a&&(e.scaling.x=s<0?-1:1)})},subplayer=function(e,t,n,o,i,r,a){var l=new BABYLON.Mesh.CreateBox("impostor",10,a);l.checkCollisions=!0,l.position.y=1,l.position.z=160,l.visibility=!1,e.lockedTarget=l,t.lockedTarget=l;var s=new createBubbles(l,a);new createPortal(a,o,i,r,20);BABYLON.SceneLoader.ImportMesh("","https://cdn.glitch.com/","2f484e40-3ae2-4ff4-bf64-4b7e86cdda2c%2Fsub.glb?1558570846894",a,function(e){e[0].parent=l,e[0].scaling.x=-e[0].scaling.x,l.rotation.x=3*-Math.PI/2,e[0].translate(new BABYLON.Vector3(-4,0,-4),2)});var c={};a.actionManager=new BABYLON.ActionManager(a),a.actionManager.registerAction(new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnKeyDownTrigger,function(e){c[e.sourceEvent.key]="keydown"==e.sourceEvent.type,(c.a||c.ArrowLeft)&&(l.scaling.x=-1),(c.d||c.ArrowLeft)&&(l.scaling.x=1)})),a.actionManager.registerAction(new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnKeyUpTrigger,function(e){c[e.sourceEvent.key]="keydown"==e.sourceEvent.type}));a.registerBeforeRender(()=>{l.position.y=1,s.update(),(c.w||c.ArrowUp)&&l.moveWithCollisions(new BABYLON.Vector3(0,0,1.2)),(c.a||c.ArrowLeft)&&(l.scaling.x=-1,l.moveWithCollisions(new BABYLON.Vector3(-1.2,0,0))),(c.s||c.ArrowDown)&&l.moveWithCollisions(new BABYLON.Vector3(0,0,-1.2)),(c.d||c.ArrowRight)&&(l.scaling.x=1,l.moveWithCollisions(new BABYLON.Vector3(1.2,0,0)))}),mobileControls(l,e,n,a);var d=BABYLON.Mesh.CreateCylinder("cylinder1",10.5,10,.3,6,1,a);d.rotation.x=Math.PI/2,d.rotation.y=Math.PI/2,d.bakeCurrentTransformIntoVertices(),d.position.y=1,d.position.z=280,d.visibility=!1,seek(d,l,a);var u=new BABYLON.StandardMaterial("xray",a);u.emissiveColor=new BABYLON.Color3(1,1,1),u.alpha=.1;var h=new BABYLON.FresnelParameters;h.isEnabled=!0,h.leftColor=new BABYLON.Color3(.5,.6,1),h.rightColor=new BABYLON.Color3(0,0,0),h.power=2,h.bias=.1;var B=new BABYLON.FresnelParameters;B.isEnabled=!0,B.leftColor=new BABYLON.Color3(1,1,1),B.rightColor=new BABYLON.Color3(.2,.2,.2),B.power=2,B.bias=.5,u.emissiveFresnelParameters=h,u.opacityFresnelParameters=B},playerPod=function(e){var t=new BABYLON.Mesh.CreateBox("pod",5,e);t.visibility=!1,t.scaling.set(14,14,5),t.rotation.x=Math.PI/2,t.position.set(-100,10,100),BABYLON.SceneLoader.ImportMesh("","https://cdn.glitch.com/","9fc921e3-db5b-4af6-9426-ecd872050c1f%2Fscene%20(3).glb?v=1561906879660",e,function(n){for(var o=0;o<n.length;o++)n[o].material=new BABYLON.StandardMaterial("m",e),n[o].name="PlayerPod",n[o].material.backFaceCulling=!1,n[o].material.diffuseColor=new BABYLON.Color3.Green,n[o].material.emissiveColor=new BABYLON.Color3.Green;n[0].scaling.set(.2,.2,.2),n[0].parent=t})},createPortal=function(e,t,n,o,i){i=i||1;BABYLON.Effect.ShadersStore.customVertexShader=" \n\t\tprecision highp float;\n\n\t\t// Attributes\n\t\tattribute vec3 position;\n\t\tattribute vec3 normal;\n        attribute vec2 uv;\n\t\t// Uniforms\n\t\tuniform mat4 world;\n\t\tuniform mat4 worldViewProjection;\n       \n\t\tvarying vec3 vPositionW;\n\t\tvarying vec3 vNormalW;\n        varying vec2 vUv;\n\tvoid main(void) {\n    \tvec4 outPosition = worldViewProjection * vec4(position, 1.0);\n    \tgl_Position = outPosition;\n\n        vUv = uv;\n    \tvPositionW = vec3(world * vec4(position, 1.0));\n    \tvNormalW = normalize(vec3(world * vec4(normal, 0.0)));\n\t}\n  \t ",BABYLON.Effect.ShadersStore.customFragmentShader="\n        precision highp float;\n\n\t\t// Lights\n\t\tvarying vec3 vPositionW;\n\t\tvarying vec3 vNormalW;\n\n\t\t// Refs\n\t\tuniform vec3 cameraPosition;\n\t\tuniform float time;\n        \n        uniform sampler2D noiseTexture;\nuniform vec3 noiseWeights;\nuniform vec3 finalColorWeights;\nuniform vec2 magnitude;\nuniform float spinFrequency;\nuniform float spinSpeed;\nuniform float portalStrength;\nuniform float portalSize;\n\nuniform float portalStartingAmplitude;\nuniform float portalAmplitudeDecayFactor;\n\nuniform vec2 portalShapeAugmenter;\n\n varying vec2 vUv;\n//-----------------------------------------------------------------------------\nfloat tex( vec2 uv )\n{\n    vec3 color = texture2D( noiseTexture, uv * 8.0 + vec2(time * magnitude.x, time * magnitude.y)).rgb;\n    \n    float t = dot( color, vec3(noiseWeights.r, noiseWeights.g, noiseWeights.b));\n    \n    t *= 1.0-length(uv * 2.0);\n    \n    return t;\n}\n \n//-----------------------------------------------------------------------------\nfloat fbm( vec2 uv )\n{\n    float sum = 0.00;\n    float amp = portalStartingAmplitude;\n    \n    for( int i = 0; i < 4; ++i )\n    {\n        sum += tex( uv ) * amp;\n        uv += uv;\n        amp *= portalAmplitudeDecayFactor;\n    }\n    \n    return sum;\n}\n\n//-----------------------------------------------------------------------------\nvec2 modifyUV( vec2 uv )\n{\n    float len = length( uv );\n    float animTime = time * spinSpeed;\n    float baseValue = (len + animTime) * spinFrequency;\n    vec2 offset = vec2( sin( baseValue * portalShapeAugmenter.x ), cos( baseValue * portalShapeAugmenter.y ) ) * portalStrength;\n    \n    return uv + offset;\n}\n \n\n\tvoid main(void) {\n\t\t\n\n   \t \tvec2 uv = vUv - 0.5;\n    uv = modifyUV( uv );\n    \n    float t = pow( fbm( uv * portalSize ), 3.0);\n    \n   vec3 m = finalColorWeights;\n   vec3 col = vec3( t * m.r * 10.0, t * m.g * 10.0, t * m.b * 10.0 );\n   if(col.r < 0.2){\n    discard;\n   }\n    gl_FragColor = vec4( col.rgb, 1.0 );\n\t\t}\n        ";var r=new BABYLON.ShaderMaterial("ball_shader",e,"custom",{attributes:["position","normal","uv"],uniforms:["worldViewProjection","world","vPositionW","vNormalW","time"]});r.setFloat("spinFrequency",10),r.setFloat("spinSpeed",.3),r.setFloat("portalStrength",.05),r.setFloat("portalStartingAmplitude",1.2),r.setFloat("portalAmplitudeDecayFactor",.8),r.setFloat("portalSize",.25),r.setVector2("magnitude",new BABYLON.Vector2(0,1)),r.setVector2("portalShapeAugmenter",new BABYLON.Vector2(1,1)),r.setVector3("finalColorWeights",new BABYLON.Vector3(.2,.4,.8)),r.setVector3("noiseWeights",new BABYLON.Vector3(.8,.3,.3)),r.setTexture("noiseTexture",new BABYLON.Texture("https://cdn.glitch.com/9fc921e3-db5b-4af6-9426-ecd872050c1f%2Fthumb_veiny.jpg?1558790356105",e));var a=0;e.onAfterCameraRenderObservable.add(function(){a+=.05,r.setFloat("time",a)});var l=BABYLON.Mesh.CreatePlane("portal",5,e);return l.material=r,l.rotation.x=Math.PI/2,l.scaling.set(i,i,i),l.position.set(t,n,o),l},initPostprocess=function(e,t){BABYLON.Effect.ShadersStore.customFragmentShader="\n    #ifdef GL_ES\n        precision highp float;\n    #endif\n\n    // Samplers\n    varying vec2 vUV;\n    uniform sampler2D textureSampler;\n\n    // Parameters\n    uniform vec2 screenSize;\n    uniform float threshold;\n    uniform float time;\n    void main(void) \n    {\n        float frequency = 10.0;\n        float amplitude = 0.003;\n        float distortion = sin(time*vUV.y*frequency)*amplitude;\n        vec4 color = texture2D(textureSampler,vec2(vUV.x+distortion, vUV.y));\n\n            gl_FragColor = color;\n        \n    }\n    ";var n=new BABYLON.PostProcess("My custom post process","custom",["screenSize","threshold","time"],null,1,t),o=0;n.onApply=function(t){t.setFloat2("screenSize",n.width,n.height),t.setFloat("threshold",.3),t.setFloat("time",Math.sin(o)),e.registerBeforeRender(()=>{o+=.05})}},createSubmarinerWorld=function(e){if(null!=e.level){var t=BABYLON.MeshBuilder.ExtrudePolygon("sea",{shape:e.level,depth:10,sideOrientation:BABYLON.Mesh.DOUBLESIDE},e);t.material=new BABYLON.StandardMaterial("deepseaMat",e),t.material.specularColor=new BABYLON.Color3.Black,t.material.diffuseTexture=e.backgroundTexture,t.layerMask=1,e.onPointerUp=function(){e.backgroundTexture.video.play()};var n=BABYLON.MeshBuilder.CreateBox("sphere",{height:.1,width:1e4,depth:1e4},e);n.position.y=-2;var o=t.clone(),i=n,r=BABYLON.CSG.FromMesh(o),a=BABYLON.CSG.FromMesh(i).intersect(r);o.dispose(),i.dispose();var l=a.toMesh("csg",new BABYLON.StandardMaterial("mat",e),e);l.position.y=3,l.material=new BABYLON.StandardMaterial("bg",e),l.material.diffuseColor=new BABYLON.Color3.Black,l.material.specularColor=new BABYLON.Color3.Black,e.level==levels.hulu&&(l.material.diffuseColor=new BABYLON.Color3.Gray,l.material.diffuseTexture=new BABYLON.Texture("https://cdn.glitch.com/9fc921e3-db5b-4af6-9426-ecd872050c1f%2FiStock-667442494.jpg?v=1563389440308",e),l.material.diffuseTexture.uScale=l.material.diffuseTexture.vScale=36);var s=BABYLON.MeshBuilder.CreateTube("debris",{path:e.level,radius:12,sideOrientation:BABYLON.Mesh.DOUBLESIDE,updatable:!0},e);s.material=new BABYLON.StandardMaterial("debrisMat",e),s.material.diffuseTexture=new BABYLON.Texture("https://cdn.glitch.com/673d0d01-5f8e-4eea-8711-f4f4f55a29bb%2Fmoss_covered_rock_texture_2_by_fairiegoodmother_d1iqdwc-fullview.jpg?1550359563126",e),s.material.diffuseTexture.uScale=s.material.diffuseTexture.vScale=6,s.material.specularColor=new BABYLON.Color3.Black,s.material.diffuseColor=new BABYLON.Color3(.5,.5,.5),s.checkCollisions=!0,s.layerMask=1}},createWasteDebris=function(e){var t=new BABYLON.StandardMaterial("texture5",e);t.diffuseTexture=new BABYLON.Texture("https://cdn.glitch.com/9fc921e3-db5b-4af6-9426-ecd872050c1f%2F1804331.png?v=1563395132430",e),t.diffuseTexture.hasAlpha=!0;for(var n=["https://cdn.glitch.com/9fc921e3-db5b-4af6-9426-ecd872050c1f%2F1804331.png?v=1563395132430","https://cdn.glitch.com/9fc921e3-db5b-4af6-9426-ecd872050c1f%2Fpair-of-yellow-socks-clip-art.png?v=1563400901755","https://cdn.glitch.com/9fc921e3-db5b-4af6-9426-ecd872050c1f%2Ftyre.png?v=1563400971009"],o=0;o<50;o++){var i=300-600*Math.random(),r=300-600*Math.random(),a=t.clone();a.diffuseTexture=new BABYLON.Texture(n[Math.floor(Math.random()*n.length)],e),a.diffuseTexture.hasAlpha=!0,a.specularColor=new BABYLON.Color3.Black;var l=BABYLON.MeshBuilder.CreatePlane("waste",{size:10},e);l.material=a,l.scaling.set(2,2,2),l.position.y=1,l.rotation.x=Math.PI/2,l.rotation.z=r,l.position.x=i,l.position.z=r}var s=0,c=[];e.registerBeforeRender(function(){if((s+=1)%100==0){var o=300-600*Math.random(),i=300-600*Math.random(),r=t.clone();r.diffuseTexture=new BABYLON.Texture(n[Math.floor(Math.random()*n.length)],e),r.diffuseTexture.hasAlpha=!0,r.specularColor=new BABYLON.Color3.Black;var a=BABYLON.MeshBuilder.CreatePlane("waste",{size:10},e);a.material=r,a.scaling.set(2,2,2),a.position.y=1,a.rotation.x=Math.PI/2,a.rotation.z=i,a.name="waste",a.gravity=i,a.position.x=o,a.position.z=200,c.push(a)}c.forEach(function(e){e.position=BABYLON.Vector3.Lerp(e.position,new BABYLON.Vector3(e.position.x,1,e.gravity),.05)})})},createScene=function(){console.log("%cWelcome dear submariner! %cThis adventure is yours!","color: blue; font-size: x-large","color: red; font-size: x-large");var e=new BABYLON.Scene(engine);e.collisionsEnabled=!0,e.clearColor=BABYLON.Color3.Black(),e.level=levels.home,e.gui=[],e.backgroundTexture=new BABYLON.VideoTexture("video",["https://cdn.glitch.com/9fc921e3-db5b-4af6-9426-ecd872050c1f%2Ffinal_5d27c29c9ea5f00014146d79_855701.mp4?v=1562886852603"],e,!0);var t=new BABYLON.ArcRotateCamera("Camera",0,.8,300,BABYLON.Vector3.Zero(),e);e.activeCameras.push(t),t.setPosition(new BABYLON.Vector3(.4088619795739057,10.783595436895611,0)),t.setTarget(new BABYLON.Vector3(0,0,200)),new BABYLON.HemisphericLight("light",new BABYLON.Vector3(0,1,0),e).intensity=.7,t.beta=.037897028819031287,t.alpha=23.55063297579997;var n=new BABYLON.ArcRotateCamera("Camera",0,.8,300,BABYLON.Vector3.Zero(),e);n.setTarget(BABYLON.Vector3.Zero()),e.activeCameras=[],e.activeCameras.push(t),t.layerMask=1,n.layerMask=2,n.setPosition(new BABYLON.Vector3(.4088619795739057,10.783595436895611,1e3)),n.setTarget(new BABYLON.Vector3(0,0,200)),n.beta=.037897028819031287,n.alpha=23.55063297579997;var o=BABYLON.GUI.AdvancedDynamicTexture.CreateFullscreenUI("UI"),i=new BABYLON.GUI.StackPanel;i.width="220px",i.horizontalAlignment=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_RIGHT,i.verticalAlignment=BABYLON.GUI.Control.VERTICAL_ALIGNMENT_CENTER,o.addControl(i);var r=new BABYLON.GUI.TextBlock;r.text="Engine cond.",r.height="30px",r.color="white",i.addControl(r);var a=new BABYLON.GUI.ImageBasedSlider;a.minimum=0,a.maximum=2*Math.PI,a.isThumbClamped=!1,a.isVertical=!0,a.displayThumb=!1,a.backgroundImage=new BABYLON.GUI.Image("back","https://www.babylonjs-playground.com/textures/gui/backgroundImage-vertical.png"),a.valueBarImage=new BABYLON.GUI.Image("value","https://cdn.glitch.com/09092405-1738-440c-b976-c47b88794255%2FVertical_gradient.jpg?v=1564259497746"),a.isVertical?(a.width="20px",a.height="200px"):(a.height="20px",a.width="200px"),a.color="red",i.addControl(a),createSubmarinerWorld(e),subplayer(t,n,o,1,1,250,e),playerPod(e);new BABYLON.BlackAndWhitePostProcess("bandw",1,t);var l="Loading",s=0;e.onReadyObservable=(engine.displayLoadingUI(),setInterval(function(){l+="🐟",4==++s&&(l="Loading",s=0),engine.loadingUIText=l},500),void setTimeout(function(){engine.hideLoadingUI()},3e3));var c="",d={mission_1:{started:!1,counter:0}},u={perInventoryData:[],perInventoryIndex:[]};return function(e,t,i){var r=function(e,t){var n=BABYLON.Mesh.CreatePlane("plane",5);n.position.addInPlace(t.position),n.rotation.addInPlace(t.rotation),n.scaling.addInPlace(t.scaling);var o=BABYLON.GUI.AdvancedDynamicTexture.CreateForMesh(n),r=new BABYLON.GUI.TextBlock;return r.text=e,r.color="black",r.fontSize=500,r.name=t.name+"Gui",o.addControl(r),n.layerMask=2,i.gui.push(r),r};i.meshes.forEach(function(e){"portal"===e.name&&new r("P",e),"pod"===e.name&&new r("H",e)});!function(){var e=new BABYLON.RenderTargetTexture("depth",1024,i,!0,!0);i.customRenderTargets.push(e),e.activeCamera=n,n.alpha=26.700632975800016,setTimeout(function(){i.meshes.forEach(function(t){"portal"!==t.name&&"viewport"!==t.name&&"PlayerPod"!==t.name&&e.renderList.push(t)})},3e3);var o=i.getMeshByName("sea").clone();o.name="viewport",o.position=new BABYLON.Vector3(canvas.width/130,canvas.height/150+4,20);var r=new BABYLON.StandardMaterial("texturePlane",i);r.diffuseColor=new BABYLON.Color3(1,1,1),r.diffuseTexture=e,r.specularColor=BABYLON.Color3.Black(),r.diffuseTexture.uScale=1,r.diffuseTexture.vScale=1,r.diffuseTexture.level=1.2,o.enableEdgesRendering(.9999999),o.edgesWidth=5,o.edgesColor=new BABYLON.Color4(0,0,0,0),r.emissiveColor=new BABYLON.Color3(1,1,1),o.material=r,o.parent=t,o.scaling.set(-.02,.02,.02),o.rotation.x=Math.PI/2,o.layerMask=1,o.renderingGroupId=2,o.position.y=2,o.rotate(new BABYLON.Vector3(0,1,0),Math.PI),i.registerBeforeRender(()=>{})}();var a=function(){var e=new BABYLON.GUI.Rectangle;e.width="440px",e.height="440px",e.cornerRadius=0,e.color="gray",e.thickness=4,e.background="silver";var t=new BABYLON.GUI.TextBlock;return t.text="THIS GAME IS MADE WITH \r\nTHE AWESOME 3D ENGINE\r\n-BABYLONJS\r\n\r\nThanks to the team who collaborated\r\nto create this beautiful engine",t.color="white",t.top="-100px",e.addControl(t),o.addControl(e),e};!function(){var e=new BABYLON.GUI.Rectangle;e.width="440px",e.height="440px",e.cornerRadius=0,e.color="gray",e.thickness=4,e.background="silver",e.isVisible=!1;for(var t=["Audio","Credits","Exit Game","Missions"],n=0;n<t.length;n++){var r=BABYLON.GUI.Button.CreateSimpleButton("but",t[n]);switch(r.width="234px",r.height="34px",r.top=n/4*240-100+"px",e.addControl(r),n){case 0:r.onPointerUpObservable.add(function(){i.backgroundTexture.video.muted=!0});break;case 1:r.onPointerUpObservable.add(function(){e.isVisible=!1;var t=new a;setTimeout(function(){t.dispose(),t.zIndex=-1},4e3)});break;case 2:r.onPointerUpObservable.add(function(){e.isVisible=!1});break;case 3:r.onPointerUpObservable.add(function(){var e=(new a).children[0];e.text=c+"\nMission progress: 0/10",setTimeout(function(){e.parent.dispose(),e.zIndex=-1},4e3)})}}o.addControl(e);var l=BABYLON.GUI.Button.CreateSimpleButton("menu","Options");l.width="134px",l.height="44px",l.horizontalAlignment=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT,l.verticalAlignment=BABYLON.GUI.Control.VERTICAL_ALIGNMENT_TOP,l.cornerRadius=10,l.color="gray",l.thickness=4,l.background="silver",o.addControl(l),l.onPointerUpObservable.add(function(){1==e.isVisible?e.isVisible=!1:e.isVisible=!0})}();!function(){var t=new BABYLON.GUI.InputText;t.width=.2,t.maxWidth=.2,t.height="40px",t.text="Input name here!",t.fontStyle="italic",t.color="white",t.background="green",t.horizontalAlignment=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_CENTER,t.verticalAlignment=BABYLON.GUI.Control.VERTICAL_ALIGNMENT_CENTER,o.addControl(t),t.onFocusObservable.add(e=>{e.text=""});var n=BABYLON.GUI.Button.CreateSimpleButton("but","Ok");n.width=.08,n.cornerRadius=10,n.horizontalAlignment=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_CENTER,n.verticalAlignment=BABYLON.GUI.Control.VERTICAL_ALIGNMENT_CENTER,n.left="166px",n.height="40px",n.color="white",n.background="green",o.addControl(n);var r=new BABYLON.GUI.TextBlock;r.text="",r.fontFamily="Chalkduster",r.color="white",r.fontSize=24,r.top="200px",isMobile&&(r.top=100),r.zIndex=-150,o.addControl(r);var a=new BABYLON.GUI.TextBlock;a.text="",a.fontFamily="Chalkduster",a.color="white",a.fontSize=14,a.top="150px",isMobile&&(a.top=50),a.zIndex=-150,o.addControl(a);var l=BABYLON.GUI.Button.CreateSimpleButton("but","SKIP");l.width="80px",l.height="50px",l.textBlock.fontFamily="Chalkduster",l.textBlock.fontSize=24,l.outlineColor="green",l.thickness=0,l.color="none",l.top="120px",l.isVisible=!1,l.left="300px",l.zIndex=-150,isMobile&&(l.top=7),o.addControl(l);var s=0,h={};n.onPointerDownObservable.add(function(){t.dispose(),s=1,this.alpha=0,localStorage.setItem("username",t.text),n.dispose()}),null!=localStorage.getItem("username")&&""!==localStorage.getItem("username")&&"Input name here!"!==localStorage.getItem("username")&&(t.dispose(),n.dispose(),s=1);var B=function(e,t){var n=new BABYLON.GUI.Rectangle;n.width="240px",n.height="240px",n.cornerRadius=0,n.color="gray",n.thickness=4,n.background="silver",n.left=e+"px",n.isVisible=!0;var i=t;n.buttons=[];for(var r=0;r<3;r++)for(var a=0;a<3;a++){var l=BABYLON.GUI.Button.CreateSimpleButton("but"+r+a,i[r]);l.width="64px",l.height="64px",l.top=r/4*240-60+"px",l.left=a/4*240-60+"px",n.addControl(l),n.buttons.push(l)}o.addControl(n),this.background=n,this.buttons=n.buttons};B.prototype.getBackgroundData=function(){return this.background},B.prototype.link=function(e){this.buttons.forEach(function(t){t.onPointerUpObservable.add(function(){e.getBackgroundData().buttons.forEach(function(e){t.name===e.name&&(""!==t.textBlock.text&&(e.textBlock.text=t.textBlock.text,t.textBlock.text="",u.perInventoryData.push(e.textBlock.text),u.perInventoryIndex.push(e)),console.log(t.textBlock.text))})})});var t=this.buttons;e.getBackgroundData().buttons.forEach(function(e){e.onPointerUpObservable.add(function(){t.forEach(function(t){e.name===t.name&&""!==e.textBlock.text&&(t.textBlock.text=e.textBlock.text,e.textBlock.text="",u.perInventoryData.push(t.textBlock.text),u.perInventoryIndex.push(t))})})})};var p=new B(-200,["🗑️","🛠️","🐟"]),m=new B(100,["","","","","",""]);p.link(m),m.getBackgroundData().isVisible=!1,p.getBackgroundData().isVisible=!1;var g=BABYLON.GUI.Button.CreateSimpleButton("menu","Inventory");g.width="184px",g.height="44px",g.horizontalAlignment=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_CENTER,g.verticalAlignment=BABYLON.GUI.Control.VERTICAL_ALIGNMENT_CENTER,g.top="-100px",g.cornerRadius=10,g.color="gray",g.thickness=4,g.background="silver",o.addControl(g),g.onPointerUpObservable.add(function(){1==m.getBackgroundData().isVisible?(m.getBackgroundData().isVisible=!1,p.getBackgroundData().isVisible=!1):(m.getBackgroundData().isVisible=!0,p.getBackgroundData().isVisible=!0)});var f=0,v=0,A={},b={};A.enabled=!1,b.enabled=!1;var x=0,N=new huluScene;i.registerAfterRender(function(){var t=i.getMeshByName("impostor"),n=i.getMeshByName("pod"),o=i.getMeshByName("portal");if(t.intersectsMesh(o)&&3==s?(d.mission_1.started=!0,d.mission_1.counter+=1):t.intersectsMesh(o)&&3!=s&&(s=4),1==d.mission_1.counter&&(N.copyPlayer(m),i.backgroundTexture.video.muted||(N.getScene().backgroundTexture.video.muted=!1),console.log("%cWelcome to Hulu underwater! %cThis adventure is yours!","color: blue; font-size: x-large","color: red; font-size: x-large"),e.stopRenderLoop(),e.runRenderLoop(function(){N.getScene().render()})),t.intersectsMesh(n)?(g.isVisible=!0,s=2):(g.isVisible=!1,m.getBackgroundData().isVisible=!1,p.getBackgroundData().isVisible=!1),m.getBackgroundData().buttons.forEach(function(e){"🗑️"!==e.textBlock.text&&"🛠️"!==e.textBlock.text&&"🐟"!==e.textBlock.text||(s=3)}),++x%8==0)switch(s){case 1:a.text="Mission Brief: Go gather some tools before sailing the hulu underwater",l.clicked||(l.isVisible=!0),l.onPointerDownObservable.add(function(){l.clicked=!0,r.text="Go to the marker indicated 'H' on your mini map",c="Go to the marker indicated 'H' on your mini map",l.isVisible=!1,i.gui.forEach(function(e){"podGui"===e.name&&(e.color="green")}),A.enabled=!0}),A.enabled||(h.intro="\nWelcome "+localStorage.getItem("username")+"! Have you come to save the underwater?\n we need your help\nPollution is now a disease to aquatic lifes\nYour job is to clear the debris for now\nFirst you will need some tools\nGo to the marker indicated 'H' on your mini map",f<h.intro.length&&(r.text+=h.intro.charAt(f),r.text.includes("\n")&&(r.text=" "),r.text.includes("Go to the marker indicated 'H' on your mini map")&&(c="Go to the marker indicated 'H' on your mini map",l.isVisible=!1,i.gui.forEach(function(e){"podGui"===e.name&&(e.color="green")})),f++));break;case 2:h.body="\nFill your inventory with these items 🗑️, 🛠️, 🐟",c="Fill your inventory with these items 🗑️, 🛠️, 🐟",r.text="Fill your inventory with these items 🗑️, 🛠️, 🐟";break;case 3:l.clicked&&(l.isVisible=!0),l.onPointerDownObservable.add(function(){l.clicked=!1,l.isVisible=!1,c="Go to the marker indicated 'P' on your minimap",r.text="Go to the marker indicated 'P' on your minimap",b.enabled=!0}),b.enabled||(h.body="\nMake sure you stack up for a tide ride!!\nGo to the marker indicated 'P'",c="Go to the marker indicated 'P' on your minimap",v<h.body.length&&(r.text+=h.body.charAt(v),r.text.includes("\n")&&(r.text=" "),v++));break;case 4:r.text="Portal closed!\nFirst Go to the marker indicated 'H' on your mini map!"}})}()}(engine,t,e),e},scene=createScene();engine.runRenderLoop(function(){scene&&(scene.render(),document.getElementById("fpsLabel").innerHTML=engine.getFps().toFixed()+" fps")}),window.addEventListener("resize",function(){engine.resize()});